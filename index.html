
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Museum Robot</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="icon" href="https://museum-robot.github.io/Museum-robot/favicon.png" >

    <script>
        //Database limits
        //Each database has the following hard limits:

        //Max 1024 collections in one database
        //JSON objects / documents / records should not exceed 100kb in size
        //Lookup relations embedded data copies are limited to one level, with sublevels as arrays of _id values

        //3 Devs / Editors / Users
        //2.500 records
        //Max 1 API - call / sec
        //Hosted web pages w /
        //    1 custom secure domain(limited)
        //100MB media storage
        //1MB file size
        //Codehooks & Jobs
        //No MongoDB option
        //Limited support



        //for every user input in the website consider to add regular expression (to solve the "" problem)
        //add the site to git hub so it would be on air


        //add the max user site capasity
        //add the max data site capasity




        let table_name_route_info = "routeinfo"
        let table_name_login = "login"
        let museum_id = ""
        let map_data
        let last_selected_station

        //A variable that represents the connection to the database
        const DB_connention = axios.create({
            baseURL:
                "https://museumrobot-66ba.restdb.io/rest",
            headers: { "x-apikey": "5f58ea37c5e01c1e033b8dbf" }
        });


        /**
         * A function that pulls from the database all the station names by specified museum_id,
         * initializes the variable datalist_tag with those names.
         */
        async function main() {
            document.getElementById("div_menu_btns").style.display = "block"
            const { data } = await DB_connention.get(`/${table_name_route_info}?q={"museum_id":"${museum_id}"}&h={"$fields": {"_id": 1,"station_name": 1} }&sort=station_name&dir=1`)
            var datalist_tag = document.getElementById("stationId")
            datalist_tag.innerHTML = ""
            //loop to initialize datalist_tag
            data.forEach(element => {
                var station_name = document.createElement('option');
                station_name.setAttribute("station_id", element._id);
                station_name.setAttribute("station_name", element.station_name);
                station_name.setAttribute("value", element.station_name);
                datalist_tag.appendChild(station_name)
            })
            stop_loading_animation("all_body", "block")


        }


        /**
         * A function that displays the data of the selected station
         */
        async function display_station_content() {
            let station_name_input = document.getElementById("choose_station_input")
            let station_name_input_value = station_name_input.value
            station_name_input.value = ""
            var div_tag = document.getElementById("station_content")
            //Pulls the appropriate element, according to the user's choice
            let station_option = document.querySelector('option[station_name="' + station_name_input_value + '"]')
            //Displays an error in case there is no suitable element for user selection
            if (station_option == null) {
                show_popup_message("please choose a valid station name");
                return
            }

            if (last_selected_station == station_name_input_value) {
                return
            }
            last_selected_station = station_name_input_value

            div_tag.style.display = "none"
            var record_id_for_url = station_option.attributes.station_id.nodeValue;
            start_loading_animation("block_user_clicks", "block")
            //Pulls from the database, the station data selected by the user
            const { data } = await DB_connention.get(`/${table_name_route_info + "/" + record_id_for_url}?q={}&h={"$fields": {"station_name": 1,"child_content": 1,"adult_content": 1,"play_child": 1 ,"play_adult": 1 ,"current_tour": 1} }`)
            for (let key in data) {

                if (key == "play_child" || key == "play_adult" || key == "current_tour") {
                    var tag_to_add_data_to = document.getElementById(key)
                    tag_to_add_data_to.checked = data[key]
                }
                else if (key == "child_content" || key == "adult_content" || key == "station_name") {
                    var tag_to_add_data_to = document.getElementById(key)
                    tag_to_add_data_to.value = data[key]
                }
            }
            document.getElementById("create_new_station_btn").style.display = "none"
            document.getElementById("update_station_btn").style.display = "inline"
            document.getElementById("delete_station_btn").style.display = "inline"
            div_tag.style.display = "block"
            stop_loading_animation("block_user_clicks", "none")
        }


        /**
        * A function that updates the database with the new station data entered by the user
        */
        async function update_station() {
            start_loading_animation("block_user_clicks", "block")
            let station_option = document.querySelector('option[station_name="' + last_selected_station + '"]')
            var record_id_for_url = station_option.attributes.station_id.nodeValue;
            var textarea_station_name = document.getElementById("station_name")
            var textarea_child_content = document.getElementById("child_content")
            var textarea_adult_content = document.getElementById("adult_content")
            var checkbox_play_adult = document.getElementById("play_adult")
            var checkbox_play_child = document.getElementById("play_child")
            var checkbox_current_tour = document.getElementById("current_tour")

            //pull the station name entered by the user from the database
            const { data } = await DB_connention.get(`/${table_name_route_info}?q={"museum_id":"${museum_id}" , "station_name": "${textarea_station_name.value}"}`)

            //Displays an error if the station name already exists in the database, not including the current station name
            if (data.length > 0 && textarea_station_name.value != last_selected_station) {
                show_popup_message("station name already taken")
                stop_loading_animation("block_user_clicks", "none")
                return
            }

            //Update the station data in the database, according to the new data entered by the user
            DB_connention.request({
                url: table_name_route_info + "/" + record_id_for_url,
                method: "put",
                data: {
                    station_name: textarea_station_name.value,
                    child_content: textarea_child_content.value,
                    adult_content: textarea_adult_content.value,
                    play_adult: checkbox_play_adult.checked,
                    play_child: checkbox_play_child.checked,
                    current_tour: checkbox_current_tour.checked,
                }
            }).then(response => {
                block_user_clicks.style.display = "none"
                stop_loading_animation("block_user_clicks", "none")
                if (response.status == 200) {
                    station_option.value = textarea_station_name.value
                    station_option.attributes.station_name.nodeValue = textarea_station_name.value
                    document.getElementById("station_content").style.display = "none"
                    document.getElementById("choose_station_input").value = ""
                    last_selected_station = ""

                    show_popup_message("station updated successfully")

                }
                else {
                    show_popup_message("something went wrong please try again");
                }

            });

        }


        /**
        * A function that deletes the station selected by the user
        */
        async function delete_station() {
            start_loading_animation("block_user_clicks", "block")
            let station_option = document.querySelector('option[station_name="' + last_selected_station + '"]')
            var record_id_for_url = station_option.attributes.station_id.nodeValue;


            var datalist = document.getElementById("stationId")
            var div_tag = document.getElementById("station_content")
            //deletes the station selected by the user in the database
            DB_connention.request({
                url: table_name_route_info + "/" + record_id_for_url,
                method: "delete"
            }).then(response => {
                stop_loading_animation("block_user_clicks", "none")
                if (response.status == 200) {
                    datalist.removeChild(station_option)
                    div_tag.style.display = "none"
                    document.getElementById("choose_station_input").value = ""
                    last_selected_station = ""

                    show_popup_message("station deleted successfully")
                }
                else {
                    show_popup_message("something went wrong please try again");
                }

            });


        }


        /**
        * A function that checks the validity of the entered station name, before adding the station to the database
        */
        async function create_new_station_data_validation() {
            let textarea_station_name = document.getElementById("station_name")

            if (textarea_station_name.value == "") {
                show_popup_message("station name cannot be empty")
                return
            }
            start_loading_animation("block_user_clicks", "block")

            //Check with the database whether the station name already exists
            const { data } = await DB_connention.get(`/${table_name_route_info}?q={"museum_id":"${museum_id}" , "station_name": "${textarea_station_name.value}"}`)
            if (data.length > 0) {
                show_popup_message("station name already taken")
                stop_loading_animation("block_user_clicks", "none")
                return
            }
            create_new_station(textarea_station_name.value);
        }

        /**
        * A function that displays a form for the user,
        * to fill in the details of the new station that will be added to the database
        */
        function display_new_station_form() {
            var div_tag = document.getElementById("station_content")
            div_tag.style.display = "block"
            document.getElementById("choose_station_input").value = ""

            document.getElementById("station_name").value = ""
            document.getElementById("child_content").value = ""
            document.getElementById("adult_content").value = ""
            document.getElementById("play_child").checked = false
            document.getElementById("play_adult").checked = false
            document.getElementById("current_tour").checked = false




            document.getElementById("create_new_station_btn").style.display = "inline"
            document.getElementById("update_station_btn").style.display = "none"
            document.getElementById("delete_station_btn").style.display = "none"

            last_selected_station = ""

        }


        /**
        * A function that adds to the database the data of the new station filled in by the user
        */
        function create_new_station(station_name) {

            let textarea_child_content = document.getElementById("child_content")
            let textarea_adult_content = document.getElementById("adult_content")
            let checkbox_play_adult = document.getElementById("play_adult")
            let checkbox_play_child = document.getElementById("play_child")
            let checkbox_current_tour = document.getElementById("current_tour")

            //Adding the new station data to the database
            DB_connention.request({
                url: table_name_route_info,
                method: "post",
                data: {
                    play_adult: checkbox_play_adult.checked,
                    play_child: checkbox_play_child.checked,
                    current_tour: checkbox_current_tour.checked,
                    station_name: station_name,
                    child_content: textarea_child_content.value,
                    adult_content: textarea_adult_content.value,
                    museum_id: museum_id


                }
            }).then(response => {

                if (response.status == 201) {
                    var datalist_tag = document.getElementById("stationId");
                    var div_tag = document.getElementById("station_content")

                    let station_name = document.createElement("OPTION");
                    station_name.setAttribute("station_id", response.data._id);
                    station_name.setAttribute("station_name", response.data.station_name);
                    station_name.setAttribute("value", response.data.station_name);
                    datalist_tag.appendChild(station_name)
                    sort_datalist("stationId")
                    div_tag.style.display = "none"
                    stop_loading_animation("block_user_clicks", "none")
                    show_popup_message("station saved successfully");

                }
                else {
                    stop_loading_animation("block_user_clicks", "none")
                    show_popup_message("something went wrong please try again");

                }

            })

        }


        /**
         * A function that performs authentication for the user's login on the site
         */
        async function user_login() {
            let input_user_name_password = document.getElementsByClassName("user_name_password")
            //Checking the compatibility of the username and password entered by the user with the database
            const { data } = await DB_connention.get(`/${table_name_login}?q={"user name":"${input_user_name_password[0].value}" ,"password" : "${input_user_name_password[1].value}"}`)
            if (data.length == 1) {
                document.getElementById("id01").style.display = "none"
                document.getElementById("container").style.display = "block"
                museum_id = data[0]["_id"]
                document.getElementsByClassName("login_error")[0].style.display = 'none'
                main()
            }
            else {
                document.getElementsByClassName("login_error")[0].style.display = 'block'
                stop_loading_animation("all_body", "block")
            }
        }


        /**
        * A function that presents the user with the username and password update form
        */
        async function display_update_password() {
            document.getElementById("id01").style.display = "block"
            document.getElementsByClassName("button_update")[0].style.display = "inline-block"
            document.getElementById("button_login").style.display = "none"
            document.getElementById("button_login").disabled = true;
            document.getElementById("old_password_label").style.display = "block"
            document.getElementById("old_password").style.display = "block"
            document.getElementById("old_password").value = ""
            document.getElementById("button_cancel").style.display = "inline-block"
            document.getElementsByClassName("login_error")[0].style.display = 'none'
            document.getElementsByClassName("user_name_password")[1].value = ""
            document.getElementsByClassName("user_name_password")[0].value = ""

        }


        /**
        * A function that updates the new username and password in the database
        */
        async function update_password() {
            //prevent default form functionalety
            event.preventDefault()
            const input_user_name_password = document.getElementsByClassName("user_name_password")
            document.getElementsByClassName("login_error")[0].style.display = 'none'
            start_loading_animation("all_body", "none")

            //Get the current username and password from the database,
            //for verification purposes, before updating them in the database
            const { data } = await DB_connention.get(`/${table_name_login}/${museum_id}`)

            //If there is no such record in the database, we get an empty array.
            if (!(Array.isArray(data))) {
                if (data.password == document.getElementById("old_password").value) {

                    //Update the new username and password in the database
                    DB_connention.request({
                        url: `/${table_name_login}/${museum_id}`,
                        method: "put",
                        data: {
                            "user name": input_user_name_password[0].value,
                            password: input_user_name_password[1].value
                        }

                    }).then(response => {
                        if (response.status != 200) {
                            show_popup_message("something went wrong please try again");

                        }
                        else {
                            show_popup_message("Password updated successfully");
                        }

                    })

                    document.getElementById("id01").style.display = "none"
                    stop_loading_animation("all_body", "block")
                    return
                }
            }
            document.getElementsByClassName("login_error")[0].style.display = 'block'
            stop_loading_animation("all_body", "block")


        }


        /**
        * A function that hides the password and username update form
        */
        function cancel_update() {
            document.getElementById("id01").style.display = "none"
        }


        /**
        * A function that sort a datalist element
        * @param  {string} datalist_id Represents the id of the datalist element
        */
        function sort_datalist(datalist_id) {
            var datalist_tag = document.getElementById(datalist_id);
            let temp_datalist = document.createElement("datalist")
            temp_datalist.innerHTML = ""
            arrTexts = new Array();
            for (i = 0; i < datalist_tag.options.length; i++) {
                arrTexts[i] = { station_name: datalist_tag.options[i].value, index: i };
            }
            arrTexts.sort((a, b) => (a.station_name > b.station_name) ? 1 : -1)
            for (i = 0; i < datalist_tag.options.length; i++) {
                temp_datalist.appendChild(datalist_tag.options[arrTexts[i].index].cloneNode(true));
            }
            datalist_tag.innerHTML = ""
            datalist_tag.innerHTML = temp_datalist.innerHTML
        }

        /**
        * A function that sort the "current_tour_stations" table
        */
        function sort_table() {
            var tbody_children = document.getElementById("current_tour_stations").children;
            arrTexts = new Array();

            for (i = 0; i < tbody_children.length; i++) {
                arrTexts[i] = {
                    tr_id: tbody_children[i].id,
                    station_name: tbody_children[i].children[0].textContent,
                    tr_innerhtml: tbody_children[i].innerHTML
                    //play_child: tbody_children[i].children[1].children[0].checked,
                    //onchange_checkbox_child: tbody_children[i].children[1].children[0].attributes.onchange.nodeValue,
                    //onchange_checkbox_adult: tbody_children[i].children[2].children[0].attributes.onchange.nodeValue,
                    //play_adult: tbody_children[i].children[2].children[0].checked
                };
            }
            console.log(arrTexts);
            arrTexts.sort((a, b) => (a.station_name > b.station_name) ? 1 : -1)
            console.log(arrTexts);
            for (i = 0; i < tbody_children.length; i++) {
                tbody_children[i].id = arrTexts[i].tr_id;
                tbody_children[i].innerHTML = arrTexts[i].tr_innerhtml
                //tbody_children[i].children[0].textContent = arrTexts[i].station_name;
                //tbody_children[i].children[1].children[0].checked = arrTexts[i].play_child
                //tbody_children[i].children[1].children[0].attributes.onchange.nodeValue = arrTexts[i].onchange_checkbox_child
                //tbody_children[i].children[2].children[0].attributes.onchange.nodeValue = arrTexts[i].onchange_checkbox_adult
                //tbody_children[i].children[2].children[0].checked = arrTexts[i].play_adult
            }
        }


        /**
         * A function that displays all the stations that belong to the current tour in the table
         */
        async function build_all_current_tour_stations() {
            start_loading_animation("all_body", "none")
            let current_tour_table_div_plus_btns = document.getElementById("current_tour_table_div_plus_btns")
            current_tour_table_div_plus_btns.style.display = "none"

            //Withdrawal of stations data included in the current tour from  database
            const { data } = await DB_connention.get(`/${table_name_route_info}?q={"museum_id":"${museum_id}" , "current_tour" : ${true} }
                                       &h={"$fields": {"_id": 1,"station_name": 1 , "play_child" : 1 , "play_adult" : 1 ,"current_tour" : 1} }&sort=station_name&dir=1`)

            if (data.length > 0) {
                current_tour_table_div_plus_btns.style.display = "block"
            }
            else {
                current_tour_table_div_plus_btns.style.display = "none"
            }
            //Creates an map-type variable that saves all changes made to the table of the current tour
            map_data = new Map(data.map(obj => [obj._id, obj]));
            let tbody_current_tour_stations = $("#current_tour_stations");
            tbody_current_tour_stations.empty();
            for (let i = 0; i < data.length; i++) {
                tbody_current_tour_stations.append(Create_Tr(data[i]));
            }

        }


        /**
        * A function that builds a new record that will be added to the table in the current tour
        * @param  {object} station A variable that holds the data required to build the new record
        */
        function Create_Tr(station) {
            let checked_text_child = ""
            let checked_text_adult = ""
            if (station.play_child) {
                checked_text_child = "checked"
            }
            else {
                checked_text_child = ""
            }
            if (station.play_adult) {
                checked_text_adult = "checked"
            }
            else {
                checked_text_adult = ""
            }

            return `<tr id="${station._id}" class="trs_current_tour_table">
                          <td class="tds_current_tour_table border_radius_left_bottom" ><span>${station.station_name}</span></td>
                          <td class="tds_current_tour_table" ><input type="checkbox" ${checked_text_child}  onchange= "update_map('child','${station._id}')"  class="${station._id}" ></td>
                          <td class="tds_current_tour_table"><input type="checkbox" ${checked_text_adult}  onchange="update_map('adult','${station._id}')" class="${station._id}" ></td>
                          <td class="tds_current_tour_table border_radius_right_bottom">
                          <button class="w3-btn w3-ripple delete_btns" onclick="delete_station_from_current_tour('${station._id}','${station.station_name}')"><i class="fa fa-close"></i></button>
                          </td>
                        </tr>`;
        }


        /**
        * A function that deletes a station from the table of the current tour
        * @param  {string} station_id
        * @param  {string} station_name
        */
        function delete_station_from_current_tour(station_id, station_name) {
            let tr_tag = document.getElementById(station_id)
            let tbody_tag = document.getElementById("current_tour_stations")
            tbody_tag.deleteRow(tr_tag.rowIndex - 1)
            map_data.get(station_id).current_tour = false
            let datalist_stations_name = document.getElementById("stations_name");
            let station_name_option = document.createElement("OPTION");
            station_name_option.setAttribute("id", station_id);
            station_name_option.setAttribute("value", station_name);
            station_name_option.setAttribute("stn_name", station_name);
            datalist_stations_name.appendChild(station_name_option)
            sort_datalist("stations_name")
        }


        /**
        * Function that updates the map variable for each change of check box in the table of the current tour
        * @param  {string} child_or_adult Represents the checkbox that called the function
        * @param  {string} station_id
        */
        function update_map(child_or_adult, station_id) {
            if (child_or_adult == "child") {
                map_data.get(station_id).play_child = (!map_data.get(station_id).play_child)
            }
            else if (child_or_adult == "adult") {
                map_data.get(station_id).play_adult = (!map_data.get(station_id).play_adult)
            }
        }


        /**
         * A function that adds a new record to the table of the current tour
         */
        function add_station_to_current_tour() {

            let station_name_input = document.getElementById("station_name_input")
            let station_name_input_value = station_name_input.value;
            let station_option = document.querySelector('option[stn_name="' + station_name_input_value + '"]')

            if (station_name_input_value == "" || station_option == null) {
                show_popup_message("you must choose a station from the list!")
                return
            }
            let stations_name_datalist = document.getElementById("stations_name")
            let add_station_to_current_tour_data = document.getElementsByClassName("add_station_to_current_tour_data")
            let tbody_current_tour_stations = $("#current_tour_stations");

            let station_object = {
                station_name: station_name_input_value,
                _id: station_option.id,
                play_child: add_station_to_current_tour_data[0].checked,
                play_adult: add_station_to_current_tour_data[1].checked,
                current_tour: true
            }
            tbody_current_tour_stations.append(Create_Tr(station_object))
            map_data.set(station_object._id, station_object)
            station_name_input.value = ""
            add_station_to_current_tour_data[0].checked = ""
            add_station_to_current_tour_data[1].checked = ""
            stations_name_datalist.removeChild(station_option)
            sort_table()
            current_tour_table_div_plus_btns.style.display = "block"
        }


        /**
         * A function that pulls from the database all the station names by specified museum_id and not in current tour,
         * initializes the variable datalist_stations_name with those names.
         */
        async function build_all_stations_not_in_current_tour() {
            const { data } = await DB_connention.get(`/${table_name_route_info}?q={"museum_id":"${museum_id}" , "current_tour" : ${false} }
                                                                                                                                &h={"$fields": {"_id": 1,"station_name": 1 } }&sort=station_name&dir=1`)
            let datalist_stations_name = document.getElementById("stations_name");
            datalist_stations_name.innerHTML = ""

            for (i = 0; i < data.length; i++) {

                let station_name = document.createElement("OPTION");
                station_name.setAttribute("id", data[i]._id);
                station_name.setAttribute("value", data[i].station_name);
                station_name.setAttribute("stn_name", data[i].station_name);
                datalist_stations_name.appendChild(station_name)
            }

        }


        /**
         * A function that updates the database according to the data of the map object
         */
        async function update_current_tour_stations_in_db() {
            let have_error = false
            let flag = false
            let message = "current tour updated successfully"

            start_loading_animation("block_user_clicks", "block")
            console.log(map_data.entries());
            for (const [key, value] of map_data.entries()) {
                if (value.current_tour == true) {
                    flag = true
                }

                await DB_connention.request({
                    url: table_name_route_info + "/" + key,
                    method: "put",
                    data: {
                        station_name: value.station_name,
                        play_adult: value.play_adult,
                        play_child: value.play_child,
                        current_tour: value.current_tour
                    }
                }).then(response => {
                    if (response.status == 200) {
                        if (value.current_tour == false) {
                            map_data.delete(key)
                        }
                        
                    }
                    else {
                        have_error = true
                        message = "something went wrong please try again"
                    }
                });
                if (have_error) {
                    show_popup_message(message);
                    break;
                }
            }
            if (flag == false) {
                let current_tour_table_div_plus_btns = document.getElementById("current_tour_table_div_plus_btns")
                current_tour_table_div_plus_btns.style.display = "none"
            }
            console.log(map_data.entries());
            show_popup_message(message);
            stop_loading_animation("block_user_clicks", "none")
        }


        /**
         * A function that deletes all station from the table of the current tour
         */
        function delete_all_station_from_current_tour() {
            let tbody_tag = document.getElementById("current_tour_stations")
            var tbody_stations_tr = document.querySelectorAll('#current_tour_stations tr');
            let datalist_stations_name = document.getElementById("stations_name");
            for (i = 0; i < tbody_stations_tr.length; ++i) {
                map_data.get(tbody_stations_tr[i].id).current_tour = false
                let station_name_option = document.createElement("OPTION");
                station_name_option.setAttribute("id", tbody_stations_tr[i].id);
                station_name_option.setAttribute("value", map_data.get(tbody_stations_tr[i].id).station_name);
                station_name_option.setAttribute("stn_name", map_data.get(tbody_stations_tr[i].id).station_name);
                datalist_stations_name.appendChild(station_name_option)
            }
            tbody_tag.innerHTML = ""
            sort_datalist("stations_name")
        }


        /**
         * A function that takes the user to the home page where he can view and edit all the stations data
         */
        function show_station_information() {
            start_loading_animation("all_body", "none")
            document.getElementById("div_display_current_station").style.display = "none"
            document.getElementById("container").style.display = "block"
            document.getElementById("btn_home_page").style.display = "none"
            document.getElementById("btn_current_tour").style.display = "inline"
            main()

        }


        /**
         * A function that takes the user to the current tour page where he can view and edit the current tour data
         */
        async function show_current_tour() {
            document.getElementById("container").style.display = "none"
            document.getElementById("div_display_current_station").style.display = "block"
            document.getElementById("btn_current_tour").style.display = "none"
            document.getElementById("btn_home_page").style.display = "inline"
            document.getElementById("station_content").style.display = "none"
            last_selected_station = ""
            build_all_current_tour_stations()
            await build_all_stations_not_in_current_tour()
            stop_loading_animation("all_body", "block")

        }


        /**
         * A function that opens for the user, the Add station current tour box
         */
        function open_add_station_form() {
            document.getElementById("div_add_station_to_current_tour_table").style.display = "block"
            document.getElementById("open_add_station_form").style.display = "none"
            document.getElementById("close_add_station_form").style.display = "inline"

        }


        /**
         * A function that closes for the user, the Add station current tour box
         */
        function close_add_station_form() {
            document.getElementById("div_add_station_to_current_tour_table").style.display = "none"
            document.getElementById("open_add_station_form").style.display = "inline"
            document.getElementById("close_add_station_form").style.display = "none"
        }


        /**
         * A function that displays the loading animation
         * @param  {string} element_id Represents the div we want to hide / show
         * @param  {string} visibility Whether to hide or show the div
         */
        function start_loading_animation(element_id, visibility) {

            $(".loading_elements").addClass("loading__letter");
            //all_body , none || block_user_clicks ,block
            document.getElementById(element_id).style.display = visibility
            document.getElementById("animation_div").style.display = "block"

        }


        /**
         * A function that hides the loading animation
         * @param  {string} element_id Represents the div we want to hide / show
         * @param  {string} visibility Whether to hide or show the div
         */
        function stop_loading_animation(element_id, visibility) {
            $(".loading_elements").removeClass("loading__letter");
            document.getElementById(element_id).style.display = visibility
            document.getElementById("animation_div").style.display = "none"

        }


        /**
         * A function that displays a message on the screen
         * @param  {string} message message content
         */
        function show_popup_message(message) {
            let popup_message_content = document.getElementById("popup_message_content")
            popup_message_content.textContent = message
            let popup_message_div = document.getElementById('popup_message_div');
            popup_message_div.style.display = "block";


        }


        /**
         * A function that hides the displayed message from the screen
         */
        function hide_popup_message() {
            let popup_message_div = document.getElementById('popup_message_div');
            popup_message_div.style.display = "none";
        }


        //Used to hide the message displayed on the screen when clicking on a part of the screen that is not the message itself
        window.onclick = function (event) {
            let popup_message_div = document.getElementById('popup_message_div');
            if (event.target == popup_message_div) {
                popup_message_div.style.display = "none";
            }
        }

    </script>



    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: aliceblue;
            /*background-image: url(https://www.therobotmuseum.eu/wp-content/themes/html5blank-stable/img/sliderMuseo.jpg)*/
            background-image: url(https://museum-robot.github.io/Museum-robot/rsz_deanna-j-3gzlhroziqg-unsplash.jpg)
        }

        /* Full-width input fields */
        input[type=text], input[type=password] {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            display: block;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        /* Set a style for all buttons */
        .w3_style {
            background-color: #4CAF50;
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            cursor: pointer;
            width: 48%;
        }

            .w3_style:hover, .cancelbtn:hover {
                opacity: 0.8;
            }

        .button_update {
            display: none;
            background-color: cornflowerblue;
        }

        #old_password_label {
            display: none;
        }

        #old_password {
            display: none;
        }


        /* Extra styles for the cancel button */
        .cancelbtn {
            width: auto;
            padding: 10px 18px;
            background-color: #f44336;
        }

        /* Center the image and position the close button */
        .imgcontainer {
            text-align: center;
            margin: 24px 0 12px 0;
            position: relative;
        }

        #container {
            display: none;
        }

        .container {
            padding: 16px;
        }

        span.psw {
            float: right;
            padding-top: 16px;
        }

        /* The Modal (background) */
        .modal {
            display: block; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            padding-top: 60px;
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto 15% auto; /* 5% from the top, 15% from the bottom and centered */
            border: 1px solid #888;
            width: 20%; /* Could be more or less, depending on screen size */
        }

        .login_error {
            display: none;
            color: red;
        }

        /* The Close Button (x) */
        .close {
            position: absolute;
            right: 25px;
            top: 0;
            color: #000;
            font-size: 35px;
            font-weight: bold;
        }

            .close:hover,
            .close:focus {
                color: red;
                cursor: pointer;
            }

        /* Add Zoom Animation */
        .animate {
            -webkit-animation: animatezoom 0.6s;
            animation: animatezoom 0.6s
        }

        @-webkit-keyframes animatezoom {
            from {
                -webkit-transform: scale(0)
            }

            to {
                -webkit-transform: scale(1)
            }
        }

        @keyframes animatezoom {
            from {
                transform: scale(0)
            }

            to {
                transform: scale(1)
            }
        }

        /* Change styles for span and cancel button on extra small screens */
        @media screen and (max-width: 300px) {
            span.psw {
                display: block;
                float: none;
            }

            .cancelbtn {
                width: 100%;
            }
        }

        w3-display-topleft {
            position: absolute;
            left: 0;
            top: 0
        }

        .w3-display-topright {
            position: absolute;
            right: 0;
            top: 0
        }

        .w3-display-bottomleft {
            position: absolute;
            left: 0;
            bottom: 0
        }

        .w3-display-container {
            position: relative
        }

        .w3-display-bottomright {
            position: absolute;
            right: 0;
            bottom: 0
        }


        .w3-display-middle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            -ms-transform: translate(-50%,-50%)
        }

        .w3-display-left {
            position: absolute;
            top: 50%;
            left: 0%;
            transform: translate(0%,-50%);
            -ms-transform: translate(-0%,-50%)
        }

        .w3-display-right {
            position: absolute;
            top: 50%;
            right: 0%;
            transform: translate(0%,-50%);
            -ms-transform: translate(0%,-50%)
        }

        .w3-display-topmiddle {
            position: absolute;
            left: 50%;
            top: 0;
            transform: translate(-50%,0%);
            -ms-transform: translate(-50%,0%)
        }

        .w3-display-bottommiddle {
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translate(-50%,0%);
            -ms-transform: translate(-50%,0%);
            color: powderblue;
        }
    </style>
    <style>


        .input_style {
            border: none;
            border-radius: 8px;
            outline: none;
            height: 50px;
            width: 390px;
            margin: 5px;
            font-size: 18px;
        }

        .search_icon {
            width: 15px;
            height: 50px;
            margin: 5px;
            max-width: 15px;
            display: inline;
            margin-left: 15px;
        }

        .go_button {
            border: none;
            width: 50px;
            height: 50px;
            margin: 5px;
            border-radius: 8px;
            background-color: cornflowerblue;
            float: right;
            color: white;
            font-size: 18px;
            outline: none;
        }

        .div_search {
            background-color: white;
            border-radius: 8px;
            width: 500px;
            height: 60px;
            margin-top: 100px;
            display: inline-block;
            box-shadow: 2px 2px 5px 2px grey;
        }

        h1 {
            color: white;
            text-align: center;
        }

        p {
            font-family: verdana;
            font-size: 20px;
        }

        .div_search_and_add {
            margin: auto;
            margin-bottom: 50px;
            width: 660px;
        }

        .add_station {
            border: none;
            width: 150px;
            height: 50px;
            margin: 5px;
            border-radius: 8px;
            background-color: cornflowerblue;
            margin: auto;
            color: white;
            font-size: 18px;
            box-shadow: 2px 2px 5px 2px grey;
            outline: none;
        }

        .div_station_info {
            margin-bottom: 50px;
            width: 60%;
            margin: auto;
            box-shadow: 5px 5px 5px grey;
        }

        .div_textarea {
            background-color: #FFFFFF;
        }

        .div_checkbox {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .div_inputs {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .textarea_tag {
            resize: none;
            height: 150px;
        }

        .btn_password {
            outline: none;
            font-size: 20px;
            margin-right: 20px;
            border: 2px solid black
        }

        .btn_current_tour {
            outline: none;
            font-size: 20px;
            margin-right: 80px;
            border: 2px solid black;
        }

        .station_inputs {
            outline: none;
            border-radius: 5px
        }

        .station_header {
            background-color: cornflowerblue
        }

        .header {
            color: cornflowerblue
        }

        .station_info_btn {
            color: white;
            background-color: cornflowerblue;
            border-radius: 5px;
            outline: none;
        }

        .div_station_info_btn {
            text-align: center;
        }

        .div_current_stations {
            text-align: center;
        }

        .table_current_stations {
            /*margin: auto;*/
            border-collapse: collapse;
        }

        .not_in_current_tour_datalist {
            margin-top: 100px;
            margin-bottom: 100px;
        }

        .add_station_to_current_tour_table {
            text-align: left;
        }

        .div_add_station_to_current_tour_table {
            background-color: #FFFFFF;
            padding: 10px 10px 10px 10px;
        }

        .div_add_station {
            width: 450px;
            margin: auto;
            margin-bottom: 50px;
            margin-top: 100px;
            box-shadow: 5px 5px 5px grey;
        }

        .td_add_station {
            padding-top: 10px;
        }

        .btns_open_close_add_station {
            outline: none;
            font-size: 30px;
            margin-left: 20px;
            padding-top: 0px;
            padding-bottom: 0px;
            background-color: cornflowerblue;
            border: none;
        }

            .btns_open_close_add_station:hover {
                box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)
            }

        .station_header_current_tour {
            background-color: cornflowerblue;
        }

        .tds_current_tour_table {
            background-color: white;
            border-bottom: 1px solid azure;
        }

        .trs_current_tour_table:hover {
            box-shadow: 5px 8px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
            border-bottom: 5px solid azure;
            background-color: blue;
        }

        .tds_current_tour_table_thead {
            padding-left: 25px;
            padding-right: 25px;
        }

        .delete_btns {
            border-radius: 5px;
        }

        .border_radius_left {
            border-radius: 5px 0px 0px 0px;
        }

        .border_radius_right {
            border-radius: 0px 5px 0px 0px;
        }

        .border_radius_right_bottom {
            border-radius: 0px 0px 5px 0px;
        }

        .border_radius_left_bottom {
            border-radius: 0px 0px 0px 5px;
        }

        .loading {
            display: flex;
            flex-direction: row;
        }

        .animation_container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loading__letter {
            font-size: 88px;
            font-weight: normal;
            letter-spacing: 4px;
            text-transform: uppercase;
            animation-name: bounce;
            animation-duration: 2s;
            animation-iteration-count: infinite;
            z-index: 5;
        }

            .loading__letter:nth-child(2) {
                animation-delay: 0.1s;
            }

            .loading__letter:nth-child(3) {
                animation-delay: 0.2s;
            }

            .loading__letter:nth-child(4) {
                animation-delay: 0.3s;
            }

            .loading__letter:nth-child(5) {
                animation-delay: 0.4s;
            }

            .loading__letter:nth-child(6) {
                animation-delay: 0.5s;
            }

            .loading__letter:nth-child(7) {
                animation-delay: 0.6s;
            }

            .loading__letter:nth-child(8) {
                animation-delay: 0.8s;
            }

            .loading__letter:nth-child(9) {
                animation-delay: 1s;
            }

            .loading__letter:nth-child(10) {
                animation-delay: 1.2s;
            }

        @keyframes bounce {
            0% {
                transform: translateY(0px);
            }

            40% {
                transform: translateY(-40px);
            }

            80%, 100% {
                transform: translateY(0px);
            }
        }

        #current_tour_table_div {
            height: 250px;
            overflow: auto;
            margin: auto;
            display: inline-block;
        }

        .popup_message_inner_div {
            background-color: gainsboro;
            width: 600px;
            height: 200px;
            text-align: center;
            margin: auto;
            margin-top: 10%;
            /*background-image: url(alertimage.jpg);*/
            /* background-size: 700px 500px;*/
        }

        #popup_message_span_div {
            position: relative;
        }

        #popup_message_content_div {
            margin-top: 8%;
        }

        #popup_message_content {
            padding: 10px;
        }
    </style>


</head>
<body>
    <div id="block_user_clicks" class="modal" style="display:none"></div>
    <div id="popup_message_div" class="modal" style="display:none">
        <div class=" popup_message_inner_div animate">
            <div id="popup_message_span_div">
                <span class="close" onclick="hide_popup_message()">x</span>
            </div>
            <br />
            <div id="popup_message_content_div">
                <h3 id="popup_message_content">baget</h3>
            </div>
        </div>
    </div>
    <div id="animation_div" class="w3-display-middle" style="text-align:center; display:none">
        <div class="animation_container ">
            <div class="loading">
                <div class="loading__letter loading_elements">L</div>
                <div class="loading__letter loading_elements">o</div>
                <div class="loading__letter loading_elements">a</div>
                <div class="loading__letter loading_elements">d</div>
                <div class="loading__letter loading_elements">i</div>
                <div class="loading__letter loading_elements">n</div>
                <div class="loading__letter loading_elements">g</div>
                <div class="loading__letter loading_elements">.</div>
                <div class="loading__letter loading_elements">.</div>
                <div class="loading__letter loading_elements">.</div>
            </div>
        </div>
    </div>
    <div id="all_body">
        <div style="display:none" id="div_menu_btns">
            <button title="change password" class="w3-display-topright  w3-btn w3-ripple  btn_password" onclick="display_update_password()"><i class="fa fa-key"></i></button>
            <button id="btn_current_tour" title="display current tour" class="w3-display-topright  w3-btn w3-ripple  btn_current_tour" onclick="show_current_tour()"><i class="fa fa-university"></i></button>
            <button id="btn_home_page" title="show and edit stations" class="w3-display-topright  w3-btn w3-ripple  btn_current_tour" style="display:none" onclick="show_station_information()"><i class="fa fa-home"></i></button>
        </div>
        <div id="container" style="display:none">
            <div class="div_search_and_add">
                <div class="div_search">
                    <div class="search_icon">
                        <i class="fa fa-search"></i>
                    </div>
                    <input class="input_style " list="stationId" id="choose_station_input" placeholder="choose a station">
                    <datalist id="stationId"></datalist>
                    <button class="go_button w3-btn w3-ripple " onclick="display_station_content()">go</button>
                </div>
                <button class="add_station w3-btn w3-ripple " value="add new station" onclick="display_new_station_form()">add station</button>
            </div>



            <div class="div_station_info" id="station_content" style="display:none">
                <div class="w3-container station_header">
                    <h2 style="color:white">Station Information</h2>
                </div>
                <div class="w3-container div_textarea ">
                    <div class="div_station_name div_inputs">
                        <label class="header"><b>Station Name</b></label>
                        <input id="station_name" class="station_inputs w3-input  " type="text">
                    </div>
                    <div class="div_child_content div_inputs">
                        <label class="header"><b>Child Content</b></label>
                        <textarea id="child_content" class="station_inputs w3-input w3-border  textarea_tag" type="text"></textarea>
                    </div>
                    <div class="div_adult_content div_inputs">
                        <label class="header"><b>Adult Content</b></label>
                        <textarea id="adult_content" class="station_inputs w3-input w3-border textarea_tag" type="text"></textarea>
                    </div>
                    <div class="div_checkbox">
                        <input id="play_child" type="checkbox" value="" />
                        <label class="header"><b>Play Child</b></label>
                    </div>
                    <div class="div_checkbox">
                        <input id="play_adult" type="checkbox" value="" />
                        <label class="header"><b>Play Adult</b></label>
                    </div>
                    <div class="div_checkbox">
                        <input id="current_tour" type="checkbox" value="" />
                        <label class="header"><b>Current Tour</b></label>
                    </div>
                    <div class="div_station_info_btn">
                        <button id="update_station_btn" class="w3-btn w3-ripple station_info_btn" style="display:none" onclick="update_station()">save</button>
                        <button id="delete_station_btn" class="w3-btn w3-ripple station_info_btn" style="display:none" onclick="delete_station()">delete</button>
                        <button id="create_new_station_btn" class="w3-btn w3-ripple station_info_btn" style="display:none" onclick="create_new_station_data_validation()">save</button>
                    </div>
                </div>
            </div>

        </div>
        <div id="id01" class="modal">

            <div class="modal-content animate">


                <div class="container">
                    <form id="form_id" onsubmit="update_password()">
                        <label for="uname"><b>Username</b></label>
                        <input type="text" pattern="[A-Za-z]{1,}" placeholder="Enter Username" name="uname" class="user_name_password" required>

                        <label for="psw"><b>Password</b></label>
                        <input type="password" pattern="[A-Za-z0-9]{1,}" placeholder="Enter Password" name="psw" class="user_name_password" required>


                        <button class="w3_style" id="button_login" onclick="user_login()">Login</button>

                        <label for="opsw" id="old_password_label"><b>old Password</b></label>

                        <input type="password" pattern="[A-Za-z0-9]{1,}" id="old_password" placeholder="Enter old Password" name="opsw" required>

                        <input type="submit" class="w3_style button_update">
                        <button class="w3_style button_update" id="button_cancel" onclick="cancel_update()">cancel</button>
                    </form>
                    <br />
                    <span class="login_error">The user name or the password are incorrenct</span>

                </div>

            </div>
        </div>










        <div id="div_display_current_station" style="display:none" class="w3-container div_current_stations">
            <div class="div_add_station not_in_current_tour_datalist" id="">
                <div class="w3-container station_header_current_tour">
                    <h3 style="color:white ; text-align:left ; display:inline">Add new station to current tour</h3>
                    <button id="open_add_station_form" title="open add station form" onclick="open_add_station_form()" class="  w3-ripple btns_open_close_add_station"><i class="fa fa-sort-down"></i></button>
                    <button id="close_add_station_form" title="close add station form" onclick="close_add_station_form()" style="display:none" class="   w3-ripple btns_open_close_add_station "><i class="fa fa-sort-up"></i></button>

                    <!--btn_password-->
                </div>
                <div id="div_add_station_to_current_tour_table" class=" div_add_station_to_current_tour_table " style="display:none">
                    <table class="add_station_to_current_tour_table">
                        <tr>
                            <td class="td_add_station"><span>Choose Station:</span></td>
                            <td class="td_add_station">
                                <div>
                                    <input list="stations_name" id="station_name_input" placeholder="choose station">
                                    <datalist id="stations_name"></datalist>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="td_add_station"><span>Play Child:</span></td>
                            <td class="td_add_station">

                                <!--<label class="header"><b>Play Child</b></label>-->
                                <input class="add_station_to_current_tour_data" type="checkbox" value="" />


                            </td>
                        </tr>
                        <tr>
                            <td class="td_add_station"><span>Play Adult:</span></td>
                            <td class="td_add_station">

                                <!--<label class="header"><b>Play Adult</b></label>-->
                                <input class="add_station_to_current_tour_data" type="checkbox" value="" />


                            </td>
                        </tr>



                    </table>
                    <div class="div_station_info_btn">
                        <button id="" class="w3-btn w3-ripple station_info_btn" onclick="add_station_to_current_tour()">add</button>
                    </div>
                </div>
            </div>

            <div id="current_tour_table_div_plus_btns">
                <div id="current_tour_table_div">
                    <table class="table_current_stations">

                        <thead style="background-color:lavender ; border:none;">

                            <tr>
                                <td class="tds_current_tour_table_thead border_radius_left">Station Name</td>
                                <td class="tds_current_tour_table_thead">Play Child Content</td>
                                <td class="tds_current_tour_table_thead">Play Adult Content</td>
                                <td class="tds_current_tour_table_thead border_radius_right">Remove Station</td>

                            </tr>

                        </thead>
                        <tbody id="current_tour_stations"></tbody>

                    </table>
                </div>
                <br />
                <button class="w3-btn w3-ripple station_info_btn" onclick="update_current_tour_stations_in_db()">save changes</button>
                <button class="w3-btn w3-ripple station_info_btn" onclick="delete_all_station_from_current_tour()">delete all</button>
            </div>
        </div>
    </div>



</body>

</html>
